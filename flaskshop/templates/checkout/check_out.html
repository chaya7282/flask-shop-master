{% import 'dashboard/_macros.html' as macros%}
{% import 'dashboard/_vendor.html' as vendor%}
{% extends "base.html" %}
{% block content %}
<div class="container">
<div class="row">
        <div class="col-md-4 order-md-2 mb-4">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
                <span class="text-muted">Your cart</span>
                <span class="badge badge-secondary badge-pill">{{current_user_cart.quantity}}</span>
            </h4>
            <ul class="list-group mb-3 sticky-top">
            {% for line in current_user_cart.lines %}
                <li class="list-group-item d-flex justify-content-between lh-condensed">
                    <div>
                        <h6 class="my-0">{{ line.variant.product }}</h6>

                     <small class="text-muted">x {{ line.quantity }}</small>
                    </div>
                    <span class="text-muted"> ${{ line.subtotal }} </span>
                </li>

              {% endfor %}

                  <li class="list-group-item d-flex justify-content-between">
                    <span>Sub total</span>
                    <strong>${{ current_user_cart.subtotal }}</strong>
                </li>
                <li class="list-group-item d-flex justify-content-between">
                    <span>Shippment (USD)</span>
                    <strong>${{current_user_cart.shipping_method.price}}</strong>
                </li>
                 <li class="list-group-item d-flex justify-content-between">
                    <span>Toal (USD)</span>
                    <strong>${{current_user_cart.total}}</strong>
                </li>
            </ul>

        </div>


        <div class="col-md-8 order-md-1">
            <h3>Your Order</h3>

            <div class="card bg-success">
            <div class="card-body">
              <h5 class="card-title">Delivery:</h5>
               {{current_user_cart.shipping_method.title}}-{{current_user_cart.shipping_method.price}}$
            </div>
            </div>
            <div class="card bg-success">
            <div class="card-body">
              <h5 class="card-title">Payment:</h5>
               {{current_user_cart.payment_method}}
            </div>
            </div>

            <h3>Contact & Adress Details</h3>
            <form method="POST" action="" enctype='multipart/form-data'>


                         {{ vendor.render_field(form.contact_name) }}




                         {{ vendor.render_field(form.contact_phone) }}


               {% with method=current_user_cart.shipping_method %}
                {% if method.address_needed %}
                <div class="mb-3">

                      {{ vendor.render_field(form.address) }}

                </div>

                <div class="row">
                    <div class="col-md-5 mb-3">

                        {{ vendor.render_field(form.city) }}

                    </div>
                    <div class="col-md-4 mb-3">

                       {{ vendor.render_field(form.province) }}

                    </div>

            <div class="form-group">
                 <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>



            </div>
          </div>
                <hr class="mb-4">

                {% endif %}
                {% endwith %}
     <div class="row">
               <hr class="mb-4">
                <input type="hidden" name="csrf_token" value="{{csrf_token()}}" />
                <button  class="btn btn-primary btn-lg btn-block" type="submit">Continue to checkout</button>

        </div>
     </form>
        </div>
</div>



</div>
{% endblock content %}